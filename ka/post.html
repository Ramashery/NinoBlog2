<!DOCTYPE html>
<html lang="en"> <!-- Язык будет установлен динамически -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="//firestore.googleapis.com">
    <link rel="dns-prefetch" href="//www.gstatic.com">
    
    <title>Blog Post | CLOISONNE ENAMEL</title>
    <meta name="description" content="An article from the art blog of Nino Kartsivadze.">
    <link rel="canonical" href="" /> <!-- Заглушка, будет заменена -->

    <meta property="og:title" content="Blog Post" />
    <meta property="og:type" content="article" />
    <meta property="og:description" content="An article from the art blog of Nino Kartsivadze." />
    <meta property="og:image" content="https://minankari.art/placeholder.jpg" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="CLOISONNE ENAMEL | Nino Kartsivadze" />
    
    <script>
        (function earlySeoBootstrap(){
            try {
                var API_KEY = "AIzaSyAxOUOxaufE60eVuyOq_P66MJ9ls_7p470";
                var PROJECT_ID = "nini-shop-7c89d";
                var params = new URLSearchParams(location.search);
                var slug = params.get('slug');
                var lang = (location.pathname.split('/').filter(Boolean).find(function(p){return ['en','ru','ka'].indexOf(p)>-1;})||'ka');
                document.documentElement.lang = lang;
                if (params.get('no_early_seo') === '1' || (function(){try{return localStorage.getItem('seoEarly')==='off';}catch(e){return false;}})()) return;
                if (!slug) return;
                var endpoint = "https://firestore.googleapis.com/v1/projects/"+PROJECT_ID+"/databases/(default)/documents:runQuery?key="+API_KEY;
                var body = { structuredQuery: { from: [{ collectionId: 'blog_posts' }], where: { fieldFilter: { field: { fieldPath: 'i18n.'+lang+'.slug' }, op: 'EQUAL', value: { stringValue: slug } } }, limit: 1 } };
                fetch(endpoint, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)})
                  .then(function(r){return r.json();})
                  .then(function(rows){
                      var doc = Array.isArray(rows) ? rows.find(function(x){return x && x.document;})?.document : null;
                      if (!doc || !doc.fields) return;
                      var fields = doc.fields;
                      var i18n = fields.i18n && fields.i18n.mapValue && fields.i18n.mapValue.fields || {};
                      var langData = i18n[lang] && i18n[lang].mapValue && i18n[lang].mapValue.fields || {};
                      function s(f){ return f && f.stringValue || ''; }
                      var title = s(langData.seoTitle) || s(langData.title) || 'Blog Post';
                      var subtitle = s(langData.subtitle);
                      var content = s(langData.content);
                      var metaDescription = s(langData.metaDescription) || subtitle || content.replace(/\[.*?\]|<[^>]*>/g, '').substring(0,160);
                      var media = (fields.mediaUrls && fields.mediaUrls.arrayValue && fields.mediaUrls.arrayValue.values ? fields.mediaUrls.arrayValue.values : []).map(function(v){return v.stringValue;});
                      var firstImage = media.filter(function(u){ return u && !/(?:youtube\.com|youtu\.be)/i.test(u);})[0];
                      var pageUrl = location.href;
                      var urlObj = new URL(pageUrl);
                      var keepParams = new Set(['slug']);
                      Array.from(urlObj.searchParams.keys()).forEach(function(k){ if(!keepParams.has(k)) urlObj.searchParams.delete(k); });
                      urlObj.hash = '';
                      var normalizedUrl = urlObj.toString();
                      document.title = title + ' | Nino Kartsivadze';
                      var md = document.querySelector('meta[name="description"]'); if (md) md.setAttribute('content', metaDescription);
                      var canonical = document.querySelector('link[rel="canonical"]'); if (canonical) canonical.setAttribute('href', normalizedUrl);
                      var ogT = document.querySelector('meta[property=\"og:title\"]'); if (ogT) ogT.setAttribute('content', title);
                      var ogD = document.querySelector('meta[property=\"og:description\"]'); if (ogD) ogD.setAttribute('content', metaDescription);
                      var ogU = document.querySelector('meta[property=\"og:url\"]'); if (ogU) ogU.setAttribute('content', normalizedUrl);
                      var ogI = document.querySelector('meta[property=\"og:image\"]'); if (ogI && firstImage) ogI.setAttribute('content', firstImage);
                      // og:locale
                      var localeMap = { en: 'en_US', ru: 'ru_RU', ka: 'ka_GE' };
                      var ogLocale = document.querySelector('meta[property="og:locale"]');
                      if (!ogLocale) { ogLocale = document.createElement('meta'); ogLocale.setAttribute('property','og:locale'); document.head.appendChild(ogLocale); }
                      ogLocale.setAttribute('content', localeMap[lang] || 'ka_GE');

                      // hreflang alternates
                      var base = 'https://minankari.art';
                      var langs = ['en','ru','ka'];
                      var created = 0;
                      langs.forEach(function(l){
                          var node = i18n[l] && i18n[l].mapValue && i18n[l].mapValue.fields;
                          var lslug = node && node.slug && node.slug.stringValue;
                          if (!lslug) return;
                          var link = document.createElement('link'); link.setAttribute('rel','alternate'); link.setAttribute('hreflang', l); link.setAttribute('href', base + '/' + l + '/post.html?slug=' + encodeURIComponent(lslug)); document.head.appendChild(link); created++;
                      });
                      if (created) {
                          var xd = document.createElement('link'); xd.rel='alternate'; xd.hreflang='x-default';
                          var enSlugNode = i18n.en && i18n.en.mapValue && i18n.en.mapValue.fields && i18n.en.mapValue.fields.slug;
                          xd.href = base + '/en/post.html?slug=' + encodeURIComponent(enSlugNode && enSlugNode.stringValue || slug);
                          document.head.appendChild(xd);
                      }

                      // BlogPosting schema
                      var schemaEl = document.getElementById('blog-post-schema');
                      if (schemaEl) {
                          var schema = { "@context":"https://schema.org", "@type":"BlogPosting", headline: title, description: metaDescription, image: firstImage ? [firstImage] : undefined, datePublished: (fields.timestamp && fields.timestamp.timestampValue) || new Date().toISOString(), dateModified: new Date().toISOString(), inLanguage: lang, author: { "@type":"Person", name: "Nino Kartsivadze" }, publisher: { "@type":"Person", name: "Nino Kartsivadze" }, mainEntityOfPage: pageUrl };
                          schemaEl.textContent = JSON.stringify(schema);
                      }

                      // Breadcrumbs
                      var breadcrumb = document.getElementById('post-breadcrumb-json');
                      if (!breadcrumb) { breadcrumb = document.createElement('script'); breadcrumb.type='application/ld+json'; breadcrumb.id='post-breadcrumb-json'; document.head.appendChild(breadcrumb); }
                      breadcrumb.textContent = JSON.stringify({ "@context":"https://schema.org", "@type":"BreadcrumbList", itemListElement: [ { "@type":"ListItem", position: 1, name: "Blog", item: base + "/blog.html" }, { "@type":"ListItem", position: 2, name: title, item: normalizedUrl } ] });
                  })
                  .catch(function(){});
            } catch(e) {}
        })();
    </script>

    <!-- ИЗМЕНЕНИЕ: Добавляем пустую заглушку для Schema, которую заполнит JavaScript -->
    <script type="application/ld+json" id="blog-post-schema">{}</script>
    
    <style>
        :root { --primary: #D4AF37; --primary-dark: #9B7C2E; --bg: #121212; --bg-dark: #080808; --glass: rgba(255, 255, 255, 0.05); --text-light: rgba(255, 255, 255, 0.9); --shadow-dark: rgba(0, 0, 0, 0.2); --shadow-light: rgba(255, 255, 255, 0.05); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: var(--bg); color: var(--text-light); overflow-x: hidden; min-height: 100vh; position: relative; }
        #particles-js { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: 2; pointer-events: none; }
        header { padding: 4rem 2rem 2rem; display: flex; flex-direction: column; align-items: center; } 
        header .logo { font-size: clamp(1.5rem, 6vw, 3.5rem); letter-spacing: clamp(0.15rem, 2vw, 0.5rem); white-space: nowrap; font-weight: 300; color: var(--primary); } 
        header .subtitle { margin-top: 1rem; font-weight: 300; letter-spacing: 0.3rem; }
        nav { display: flex; justify-content: center; align-items: center; margin-bottom: 3rem; flex-wrap: wrap; gap: 1rem; flex-direction: row; background: rgba(212, 175, 55, 0.1); padding: 1rem; border-radius: 8px; } 
        .main-nav { display: flex; justify-content: center; flex-wrap: wrap; gap: 1rem; width: 100%; } 
        .sub-nav { display: none; width: 100%; margin-top: 1rem; border-top: 1px solid rgba(212, 175, 55, 0.1); padding-top: 1rem; } 
        .nav-link { margin: 0 1rem; color: var(--text-light); text-decoration: none; position: relative; padding: 0.5rem 0; font-size: 0.9rem; cursor: pointer; } 
        .nav-link.has-dropdown { position: relative; }
        .nav-link.has-dropdown:hover .sub-nav { display: flex; }
        .nav-link.has-dropdown .sub-nav { position: absolute; top: 100%; left: 0; background: var(--bg-dark); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 8px; padding: 1rem; min-width: 200px; z-index: 1000; flex-direction: column; gap: 0.5rem; }
        .nav-link.has-dropdown .sub-nav .nav-link { margin: 0; padding: 0.5rem; font-size: 0.8rem; }
        .nav-link.has-dropdown .sub-nav .nav-link:hover { background: rgba(212, 175, 55, 0.1); border-radius: 4px; }
        .nav-link-container { position: relative; }
        .nav-link-container .nav-link { margin: 0 1rem; }
        .nav-link::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 1px; background: var(--primary); transition: width 0.3s ease; } 
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }
        .page-container, .related-container { max-width: 900px; margin: 2rem auto; padding: 2rem; background: var(--glass); border-radius: 24px; backdrop-filter: blur(12px); border: 1px solid rgba(212, 175, 55, 0.1); opacity: 0; transition: opacity 0.5s; position: relative; z-index: 1; display: none; }
        @media (min-width: 992px) { .page-container, .related-container { max-width: 1100px; } }
        .page-container.loaded, .related-container.loaded { opacity: 1; }
        .post-header { padding-bottom: 1rem; border-bottom: 1px solid rgba(212, 175, 55, 0.2); text-align: center; margin-bottom: 2rem; }
        .post-title { font-size: clamp(1.8rem, 5vw, 2.8rem); color: var(--primary); font-weight: 300; }
        .post-subtitle { font-size: 1.5rem; font-weight: 300; margin-top: 0.5rem; opacity: 0.9; }
        .post-date { font-size: 0.9rem; opacity: 0.6; margin-top: 1rem; display: block; }
        .post-body { line-height: 1.8; font-size: 1.1rem; }
        .post-body .embedded-image { max-width: 100%; height: auto; border-radius: 16px; margin: 1.5rem 0; display: block; }
        .post-body .embedded-video { width: 100%; aspect-ratio: 16/9; border-radius: 16px; margin: 1.5rem 0; border: none; }
        .post-body a { color: var(--primary); text-decoration: none; border-bottom: 1px dotted var(--primary); }
        .post-body a:hover { color: var(--bg-dark); background-color: var(--primary); }
        .slideshow-container { width: 100%; height: auto; aspect-ratio: 1 / 1; margin-bottom: 2rem; position: relative; border-radius: 16px; overflow: hidden; box-shadow: 4px 4px 8px var(--shadow-dark); -webkit-mask-image: -webkit-radial-gradient(white, black); background-color: var(--glass); }
        .slideshow-item { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 1.2s ease-in-out; }
        .slideshow-item.active { opacity: 1; }
        .slideshow-item-video { width: 140%; height: 140%; top: -20%; left: -20%; position: absolute; }
        .slideshow-item-video iframe { width: 100%; height: 100%; border: none; }
        .slideshow-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; cursor: grab; }
        .back-link { display: inline-block; margin-top: 2rem; color: var(--primary); text-decoration: none; text-align: center; width: 100%; } 
        .back-link:hover { text-decoration: underline; }
        #message-container { text-align: center; font-size: 1.5rem; padding: 5rem 1rem; color: var(--primary); z-index: 1; position: relative; }
        .related-title { font-size: 2rem; color: var(--primary); font-weight: 300; text-align: center; margin-bottom: 2rem; }
        .related-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; }
        .product-card, .blog-post-card { display: flex; flex-direction: column; background: var(--glass); border-radius: 24px; box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light); backdrop-filter: blur(12px); transition: transform 0.4s, box-shadow 0.4s; overflow: hidden; position: relative; border: 1px solid rgba(212, 175, 55, 0.1); text-decoration: none; color: var(--text-light); }
        .product-card:hover, .blog-post-card:hover { transform: translateY(-8px); }
        .product-card .slideshow-container, .blog-post-card .slideshow-container { height: 250px; aspect-ratio: unset; clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%); transition: clip-path 0.5s ease; margin-bottom: 0; }
        .product-card:hover .slideshow-container, .blog-post-card:hover .slideshow-container { clip-path: polygon(0 0, 100% 0, 100% 100%, 0 85%); }
        .product-card .product-info, .blog-post-card .post-card-content { padding: 1.5rem; display: flex; flex-direction: column; flex-grow: 1; }
        .product-card .product-title, .blog-post-card .post-card-title { font-size: 1.2rem; margin-bottom: 0.5rem; color: var(--primary); }
        .product-card .product-price { font-size: 1rem; font-weight: 700; margin-bottom: 1rem; }
        .blog-post-card .post-card-subtitle { font-size: 1rem; font-weight: 300; opacity: 0.8; margin-bottom: 1rem; line-height: 1.4; }
        .blog-post-card .post-card-date { margin-top: auto; font-size: 0.8rem; opacity: 0.6; padding-top: 1rem; }
        .gold-button { display: inline-block; text-align: center; background: none; border: none; color: var(--primary); padding: 0.8rem 1.5rem; font-size: 1rem; border-radius: 50px; position: relative; overflow: hidden; cursor: pointer; z-index: 1; transition: color 0.3s; border: 1px solid rgba(212, 175, 55, 0.3); box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light); }
        .gold-button::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary); z-index: -1; clip-path: circle(0% at 50% 50%); transition: clip-path 0.5s ease; }
        .gold-button:hover { color: var(--bg-dark); }
        .gold-button:hover::before { clip-path: circle(100% at 50% 50%); }
        footer { text-align: center; padding: 2rem; margin-top: 4rem; z-index: 1; position: relative; }
        .post-title { text-align: left; }
        .post-subtitle { text-align: left; }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <header>
        <a href="../index.html" style="text-decoration: none;"><div class="logo">CLOISONNÉ ENAMEL</div></a>
        <p class="subtitle">NINO KARTSIVADZE</p>
    </header>
    <nav>
        <div class="nav-link-container">
            <a href="../index.html" class="nav-link has-dropdown">ENAMEL</a>
            <div class="sub-nav">
                <a href="#" class="nav-link" data-category="all">SHOW ALL</a>
            </div>
        </div>
        <div class="nav-link-container">
            <a href="../cast.html" class="nav-link has-dropdown">CAST</a>
            <div class="sub-nav">
                <a href="#" class="nav-link" data-category="all">SHOW ALL</a>
            </div>
        </div>
        <div class="nav-link-container">
            <a href="../about.html" class="nav-link">ABOUT ME</a>
        </div>
        <div class="nav-link-container">
            <a href="../blog.html" class="nav-link has-dropdown">BLOG</a>
            <div class="sub-nav">
                <a href="../blog.html?lang=en" class="nav-link">ENGLISH</a>
                <a href="../blog.html?lang=ka" class="nav-link">GEORGIAN</a>
                <a href="../blog.html?lang=ru" class="nav-link">RUSSIAN</a>
            </div>
        </div>
    </nav>

    <div id="message-container">Loading post...</div>
    <div class="page-container" id="post-content-wrapper"></div>

    <div class="related-container" id="related-posts">
        <h2 class="related-title">Read more articles</h2>
        <div class="related-grid" id="related-posts-grid"></div>
    </div>
    <div class="related-container" id="related-products">
        <h2 class="related-title">Featured jewelry</h2>
        <div class="related-grid" id="related-products-grid"></div>
    </div>
    
    <footer>
        <p></p> 
    </footer>

    <script src="https://www.youtube.com/iframe_api" async defer></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const firebaseConfig = {
              apiKey: "AIzaSyAxOUOxaufE60eVuyOq_P66MJ9ls_7p470",
              authDomain: "nini-shop-7c89d.firebaseapp.com",
              projectId: "nini-shop-7c89d",
              storageBucket: "nini-shop-7c89d.appspot.com",
              messagingSenderId: "595482257713",
              appId: "1:595482257713:web:3e3d3bf75f03c08e58a810",
              measurementId: "G-0HX4N09DYT"
            };
            if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
            const db = firebase.firestore();

            const particleConfig = { "particles": { "number": { "value": 80, "density": { "enable": true, "value_area": 800 }}, "color": { "value": "#D4AF37" }, "shape": { "type": "circle" }, "opacity": { "value": 0.5, "random": true, "anim": { "enable": true, "speed": 1, "opacity_min": 0.1 }}, "size": { "value": 3, "random": true, "anim": { "enable": true, "speed": 2, "size_min": 0.1 }}, "line_linked": { "enable": true, "distance": 150, "color": "#D4AF37", "opacity": 0.2, "width": 1 }, "move": { "enable": true, "speed": 1, "direction": "none", "random": true, "out_mode": "out" }}, "interactivity": { "events": { "onhover": { "enable": true, "mode": "grab" }, "onclick": { "enable": true, "mode": "push" }}}, "retina_detect": true };
            if (document.getElementById('particles-js')) { particlesJS('particles-js', particleConfig); }

            function isYoutubeUrl(url) { return /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.?be)\/.+$/.test(url); }
            
            function getYoutubeEmbedUrl(url, withControls = false) {
                let videoId;
                try { const urlObj = new URL(url); videoId = (urlObj.hostname === 'youtu.be') ? urlObj.pathname.slice(1) : urlObj.searchParams.get('v'); } catch (e) { return null; }
                if (!videoId) return null;
                const params = new URLSearchParams({ enablejsapi: 1, origin: window.location.origin });
                if (withControls) { params.set('controls', 1); } else { params.set('autoplay', 1); params.set('mute', 1); params.set('loop', 1); params.set('playlist', videoId); params.set('controls', 0); }
                return `https://www.youtube.com/embed/${videoId}?${params.toString()}`;
            }
            
            function createMediaElement(mediaUrl, title) {
                if (isYoutubeUrl(mediaUrl)) {
                    const embedUrl = getYoutubeEmbedUrl(mediaUrl, false);
                    if (!embedUrl) return null;
                    const wrapper = document.createElement('div'); wrapper.className = 'slideshow-item slideshow-item-video';
                    const iframe = document.createElement('iframe'); iframe.src = embedUrl; iframe.title = title + ' - YouTube Video'; wrapper.appendChild(iframe); return wrapper;
                } else {
                    const img = document.createElement('img'); img.src = mediaUrl; img.alt = title; img.className = 'slideshow-item'; return img;
                }
            }
            
            function setupSlideshow(container) {
                if (!container) return;
                const slides = Array.from(container.querySelectorAll('.slideshow-item, .slideshow-item-video'));
                if (slides.length <= 1) { if (slides.length === 1) slides[0].classList.add('active'); return; }
                if (container.querySelector('.slideshow-overlay')) return;
                const overlay = document.createElement('div'); overlay.className = 'slideshow-overlay'; container.appendChild(overlay);
                let currentIndex = 0; let intervalId = setInterval(() => showSlide(currentIndex + 1), 5000);
                function showSlide(index) {
                    const oldSlide = slides[currentIndex]; if (oldSlide) oldSlide.classList.remove('active');
                    currentIndex = (index + slides.length) % slides.length;
                    const newSlide = slides[currentIndex]; if (newSlide) setTimeout(() => newSlide.classList.add('active'), 1300);
                }
                function manualSlide(direction) { clearInterval(intervalId); showSlide(currentIndex + direction); intervalId = setInterval(() => showSlide(currentIndex + 1), 5000); }
                let touchStartX = 0;
                overlay.addEventListener('mousedown', e => { touchStartX = e.clientX; clearInterval(intervalId); });
                overlay.addEventListener('mouseup', e => { if (e.clientX < touchStartX - 50) manualSlide(1); else if (e.clientX > touchStartX + 50) manualSlide(-1); intervalId = setInterval(() => showSlide(currentIndex + 1), 5000); });
                showSlide(0);
            }

            function parseContentForDisplay(content) {
                if (!content) return '';
                const imageRegex = /\[image:\s*(https?:\/\/[^\s\]]+)\s*\]/g;
                const youtubeRegex = /\[youtube:\s*(https?:\/\/[^\s\]]+)\s*\]/g;
                return content
                    .replace(imageRegex, (match, url) => `<img src="${url}" class="embedded-image" alt="Embedded content" loading="lazy">`)
                    .replace(youtubeRegex, (match, url) => {
                        const embedUrl = getYoutubeEmbedUrl(url, true);
                        return embedUrl ? `<iframe src="${embedUrl}" class="embedded-video" title="Embedded YouTube video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>` : '';
                    })
                    .replace(/\n/g, '<br>');
            }
            
            async function loadRelatedPosts(currentPostId, currentLang) {
                const container = document.getElementById('related-posts');
                const grid = document.getElementById('related-posts-grid');
                if (!container || !grid) return;
                const snapshot = await db.collection('blog_posts').orderBy('timestamp', 'desc').get();
                const relatedPosts = snapshot.docs
                    .filter(doc => doc.id !== currentPostId && doc.data().i18n?.[currentLang]?.slug)
                    .slice(0, 3);
                if (relatedPosts.length > 0) {
                    container.style.display = 'block'; setTimeout(() => container.classList.add('loaded'), 50); grid.innerHTML = '';
                    relatedPosts.forEach(doc => {
                        const post = doc.data(); const langData = post.i18n[currentLang];
                        const cardLink = document.createElement('a'); cardLink.href = `../${currentLang}/post.html?slug=${langData.slug}`; cardLink.className = 'blog-post-card';
                        const mediaUrls = post.mediaUrls && post.mediaUrls.length > 0 ? post.mediaUrls : ['https://via.placeholder.com/280x250.png/121212/D4AF37?text=No+Image'];
                        const slideshowHTML = `<div class="slideshow-container">${mediaUrls.map(url => createMediaElement(url, langData.title)?.outerHTML || '').join('')}</div>`;
                        const postInfoHTML = `<div class="post-card-content"><h3 class="post-card-title">${langData.title || ''}</h3>${langData.subtitle ? `<h4 class="post-card-subtitle">${langData.subtitle}</h4>` : ''}<p class="post-card-date">${new Date(post.timestamp.seconds * 1000).toLocaleDateString()}</p></div>`;
                        cardLink.innerHTML = slideshowHTML + postInfoHTML; grid.appendChild(cardLink); setupSlideshow(cardLink.querySelector('.slideshow-container'));
                    });
                }
            }
            
            async function loadRandomProducts(count) {
                const container = document.getElementById('related-products');
                const grid = document.getElementById('related-products-grid');
                if (!container || !grid) return;
                const snapshot = await db.collection('products').get();
                let allProducts = snapshot.docs.map(doc => doc.data());
                allProducts.sort(() => 0.5 - Math.random());
                const randomProducts = allProducts.slice(0, count);
                if (randomProducts.length > 0) {
                    container.style.display = 'block'; setTimeout(() => container.classList.add('loaded'), 250); grid.innerHTML = '';
                    randomProducts.forEach(product => {
                        const cardLink = document.createElement('a'); cardLink.href = `../product.html?slug=${product.slug}`; cardLink.className = 'product-card';
                        const mediaUrls = product.images && product.images.length > 0 ? product.images : ['https://via.placeholder.com/280x250.png/121212/D4AF37?text=No+Image'];
                        const slideshowHTML = `<div class="slideshow-container">${mediaUrls.map(url => createMediaElement(url, product.title)?.outerHTML || '').join('')}</div>`;
                        const productInfoHTML = `<div class="product-info"><h3 class="product-title">${product.title}</h3><p class="product-price">${product.price}</p><div class="gold-button">VIEW DETAILS</div></div>`;
                        cardLink.innerHTML = slideshowHTML + productInfoHTML; grid.appendChild(cardLink); setupSlideshow(cardLink.querySelector('.slideshow-container'));
                    });
                }
            }

            // ИЗМЕНЕНИЕ: Новая функция для динамического обновления Schema
            function updateSchema(postData) {
                const schemaScript = document.getElementById('blog-post-schema');
                if (!schemaScript) return; // Выходим, если тег не найден

                const imageList = (postData.mediaUrls || []).filter(url => !isYoutubeUrl(url));
                const schema = {
                    "@context": "https://schema.org",
                    "@type": "BlogPosting",
                    "mainEntityOfPage": { "@type": "WebPage", "@id": window.location.href },
                    "headline": postData.title,
                    "description": postData.metaDescription,
                    "image": imageList.length > 0 ? imageList : ["https://minankari.art/placeholder.jpg"],
                    "author": { "@type": "Person", "name": "Nino Kartsivadze", "url": "https://minankari.art/about.html" },
                    "publisher": {
                        "@type": "Organization",
                        "name": "CLOISONNE ENAMEL by Nino Kartsivadze",
                        "logo": { "@type": "ImageObject", "url": "https://minankari.art/logo.png" } // Укажите реальный URL логотипа
                    },
                    "datePublished": postData.datePublished,
                    "dateModified": postData.datePublished
                };

                schemaScript.textContent = JSON.stringify(schema, null, 2);
            }

            function renderNavigation() {
                const nav = document.querySelector('nav');
                if (!nav) return;
                nav.innerHTML = '';
                let delay = 1;
                
                // Основная навигация с выпадающими меню
                const mainLinks = [
                    { 
                        href: '../index.html', 
                        text: 'ENAMEL', 
                        id: 'nav-enamel',
                        hasDropdown: true,
                        dropdownItems: []
                    },
                    { 
                        href: '../cast.html', 
                        text: 'CAST', 
                        id: 'nav-cast',
                        hasDropdown: true,
                        dropdownItems: []
                    },
                    { href: '../about.html', text: 'ABOUT ME', id: 'nav-about' },
                    { 
                        href: '../blog.html', 
                        text: 'BLOG', 
                        id: 'nav-blog',
                        hasDropdown: true,
                        dropdownItems: [
                            { text: 'ENGLISH', lang: 'en' },
                            { text: 'GEORGIAN', lang: 'ka' },
                            { text: 'RUSSIAN', lang: 'ru' }
                        ]
                    }
                ];

                mainLinks.forEach(linkInfo => {
                    const linkContainer = document.createElement('div');
                    linkContainer.className = 'nav-link-container';
                    
                    const mainLink = document.createElement('a');
                    mainLink.href = linkInfo.href;
                    mainLink.id = linkInfo.id;
                    mainLink.className = `nav-link ${linkInfo.hasDropdown ? 'has-dropdown' : ''}`;
                    mainLink.style.setProperty('--delay', delay++);
                    mainLink.textContent = linkInfo.text;
                    
                    linkContainer.appendChild(mainLink);
                    
                    // Создаем выпадающее меню если нужно
                    if (linkInfo.hasDropdown && linkInfo.dropdownItems.length > 0) {
                        const dropdown = document.createElement('div');
                        dropdown.className = 'sub-nav';
                        
                        if (linkInfo.id === 'nav-blog') {
                            // Для блога - языки
                            linkInfo.dropdownItems.forEach(item => {
                                const langLink = document.createElement('a');
                                langLink.href = `${linkInfo.href}?lang=${item.lang}`;
                                langLink.className = 'nav-link';
                                langLink.textContent = item.text;
                                dropdown.appendChild(langLink);
                            });
                        } else {
                            // Для товаров - подкатегории
                            const allLink = document.createElement('a');
                            allLink.href = '#';
                            allLink.className = 'nav-link';
                            allLink.textContent = 'SHOW ALL';
                            allLink.dataset.category = 'all';
                            dropdown.appendChild(allLink);
                        }
                        
                        linkContainer.appendChild(dropdown);
                    }
                    
                    nav.appendChild(linkContainer);
                });
            }

            async function loadPost() {
                const wrapper = document.getElementById('post-content-wrapper');
                const messageContainer = document.getElementById('message-container');
                const pathParts = window.location.pathname.split('/').filter(p => p);
                const currentLang = pathParts.find(p => ['en', 'ka', 'ru'].includes(p)) || 'en';
                const params = new URLSearchParams(window.location.search);
                const currentSlug = params.get('slug');

                if (!currentSlug) { messageContainer.textContent = 'Error: Post not found.'; return; }

                const slugField = `i18n.${currentLang}.slug`;
                const snapshot = await db.collection('blog_posts').where(slugField, '==', currentSlug).limit(1).get();
                
                if (snapshot.empty) { messageContainer.textContent = `Sorry, the post with slug "${currentSlug}" could not be found.`; return; }

                const postDoc = snapshot.docs[0]; const post = postDoc.data(); const postId = postDoc.id;
                const langData = post.i18n?.[currentLang] || {};
                const title = langData.title || 'Untitled Post'; const subtitle = langData.subtitle || ''; const content = langData.content || 'Content for this language is not available.';
                
                document.documentElement.lang = currentLang;
                const seoTitle = langData.seoTitle || title; 
                const metaDescription = langData.metaDescription || subtitle || content.replace(/\[.*?\]|<[^>]*>/g, '').substring(0, 160);
                
                document.title = `${seoTitle} | Nino Kartsivadze`;
                document.querySelector('meta[name="description"]').setAttribute('content', metaDescription);
                (function(){ const u = new URL(window.location.href); const keep = new Set(['slug']); Array.from(u.searchParams.keys()).forEach(k => { if(!keep.has(k)) u.searchParams.delete(k); }); u.hash = ''; document.querySelector('link[rel="canonical"]').setAttribute('href', u.toString()); })();
                // Обновляем OG теги для соцсетей
                document.querySelector('meta[property="og:title"]').setAttribute('content', seoTitle);
                document.querySelector('meta[property="og:description"]').setAttribute('content', metaDescription);
                const firstImage = (post.mediaUrls || []).filter(url => !isYoutubeUrl(url))[0];
                if (firstImage) {
                    document.querySelector('meta[property="og:image"]').setAttribute('content', firstImage);
                }


                const postDate = post.timestamp ? new Date(post.timestamp.seconds * 1000) : new Date();
                const slideshowContainerHTML = (post.mediaUrls && post.mediaUrls.length > 0) 
                    ? `<div class="slideshow-container">${post.mediaUrls.map(url => createMediaElement(url, title)?.outerHTML || '').join('')}</div>`
                    : '';
                
                wrapper.innerHTML = `
                    <div class="post-header">
                        <h1 class="post-title">${title}</h1>
                        ${subtitle ? `<h2 class="post-subtitle">${subtitle}</h2>` : ''}
                        <p class="post-date">Published on ${postDate.toLocaleDateString()}</p>
                    </div>
                    ${slideshowContainerHTML}
                    <div class="post-body">
                        ${parseContentForDisplay(content)}
                    </div>
                    <a href="../blog.html" class="back-link">← Back to Blog</a>
                `;

                // Вызываем функцию обновления Schema с реальными данными
                updateSchema({
                    title: seoTitle,
                    metaDescription: metaDescription,
                    mediaUrls: post.mediaUrls,
                    datePublished: postDate.toISOString()
                });

                messageContainer.style.display = 'none'; wrapper.style.display = 'block'; setTimeout(() => wrapper.classList.add('loaded'), 50);
                if(slideshowContainerHTML) { setupSlideshow(wrapper.querySelector('.slideshow-container')); }
                
                loadRelatedPosts(postId, currentLang);
                loadRandomProducts(3);
            }

            loadPost();
            
            // Рендерим навигацию
            // renderNavigation();
        });
    </script>
</body>
</html>